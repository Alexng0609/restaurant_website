{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Trang Ch·ªß - B√≤ Nh√∫ng Gi·∫•m Ng√†y X∆∞a{% endblock %}

{% block content %}
<style>
    .hero {
        background: linear-gradient(135deg, #D4A843 0%, #B8860B 100%);
        color: white;
        padding: 4rem 2rem;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 3rem;
        box-shadow: 0 10px 30px rgba(212, 168, 67, 0.3);
    }
    
    .hero-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
    }
    
    .hero-logo {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 5px solid white;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
        0%, 100% {
            transform: translateY(0px);
        }
        50% {
            transform: translateY(-10px);
        }
    }
    
    .hero h1 {
        font-size: 3rem;
        margin: 0;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    .hero p {
        font-size: 1.3rem;
        margin-bottom: 1rem;
        opacity: 0.95;
    }
    
    .hero-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .section-title {
        font-size: 2rem;
        margin-bottom: 2rem;
        color: var(--text-color);
        text-align: center;
    }
    
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }
    
    .news-card {
        background: var(--card-bg);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 6px var(--shadow);
        transition: transform 0.3s, box-shadow 0.3s;
        border: 1px solid var(--border-color);
        text-decoration: none;
        display: block;
        cursor: pointer;
        position: relative;
    }
    
    .news-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px var(--shadow);
    }
    
    .news-card-media {
        width: 100%;
        height: 200px;
        overflow: hidden;
        background: var(--border-color);
        position: relative;
    }
    
    .news-card-media img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .news-card:hover .news-card-media img {
        transform: scale(1.1);
    }
    
    .news-card-media video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        pointer-events: none;
    }
    
    .video-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 5px;
        z-index: 2;
    }
    
    .news-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
        padding: 1rem;
        transform: translateY(100%);
        transition: transform 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        gap: 0.5rem;
    }
    
    .news-card:hover .news-overlay {
        transform: translateY(0);
    }
    
    .news-card-content {
        padding: 1.5rem;
    }
    
    .news-card h3 {
        color: #D4A843;
        margin-bottom: 0.5rem;
        transition: color 0.3s ease;
    }
    
    .news-card:hover h3 {
        color: #B8860B;
    }
    
    .news-card p {
        color: var(--text-color);
        opacity: 0.9;
        line-height: 1.6;
    }
    
    .news-card small {
        color: var(--text-color);
        opacity: 0.7;
        display: flex;
        align-items: center;
        gap: 0.3rem;
        margin-top: 0.5rem;
    }
    
    .no-media-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        opacity: 0.3;
    }
    
    .item-card {
        background: var(--card-bg);
        border-radius: 10px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 4px 6px var(--shadow);
        transition: transform 0.3s;
        border: 1px solid var(--border-color);
    }
    
    .item-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px var(--shadow);
    }
    
    .item-card h3 {
        color: var(--text-color);
        margin-bottom: 0.5rem;
    }
    
    .item-card p {
        color: var(--text-color);
        opacity: 0.8;
    }
    
    .item-card .price {
        font-size: 1.5rem;
        color: #D4A843;
        font-weight: bold;
        margin-top: 1rem;
    }
    
    .cta-section {
        text-align: center;
        padding: 3rem 2rem;
        background: linear-gradient(135deg, #E5B960 0%, #D4A843 100%);
        color: white;
        border-radius: 15px;
        margin-top: 3rem;
        box-shadow: 0 10px 30px rgba(229, 185, 96, 0.3);
    }
    
    .cta-section h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    .cta-section p {
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    
    /* Google Reviews Section */
    .reviews-section {
        padding: 4rem 0;
        background: var(--bg-color);
    }

    .google-maps-container {
        display: grid;
        grid-template-columns: 1.5fr 1fr;
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .map-wrapper {
        width: 100%;
        height: 450px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 12px var(--shadow);
    }

    .review-summary {
        background: var(--card-bg);
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px var(--shadow);
        border: 2px solid var(--border-color);
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .rating-overview {
        text-align: center;
        padding-bottom: 1.5rem;
        border-bottom: 2px solid var(--border-color);
    }

    .rating-score .score {
        font-size: 4rem;
        font-weight: bold;
        color: #D4A843;
        display: block;
        line-height: 1;
    }

    .stars {
        color: #FFD700;
        font-size: 1.5rem;
        margin: 0.5rem 0;
    }

    .review-count {
        color: var(--text-color);
        opacity: 0.8;
        margin-top: 0.5rem;
    }

    .review-highlights {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .highlight-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--bg-color);
        border-radius: 8px;
        transition: var(--transition);
    }

    .highlight-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px var(--shadow);
    }

    .highlight-item i {
        color: #D4A843;
        font-size: 1.2rem;
    }

    .highlight-item span {
        color: var(--text-color);
        font-weight: 600;
        font-size: 0.9rem;
    }

    .view-reviews-btn,
    .write-review-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        padding: 1rem;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 700;
        transition: var(--transition);
        text-align: center;
    }

    .view-reviews-btn {
        background: linear-gradient(135deg, #D4A843 0%, #B8860B 100%);
        color: white;
    }

    .view-reviews-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px var(--shadow);
    }

    .write-review-btn {
        background: var(--card-bg);
        color: var(--text-color);
        border: 2px solid var(--border-color);
    }

    .write-review-btn:hover {
        border-color: #D4A843;
        color: #D4A843;
    }

    .sample-reviews {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
    }

    .review-card {
        background: var(--card-bg);
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px var(--shadow);
        border: 2px solid var(--border-color);
        transition: var(--transition);
    }

    .review-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px var(--shadow);
    }

    .review-header {
        margin-bottom: 1rem;
    }

    .reviewer-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .reviewer-avatar {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #D4A843 0%, #B8860B 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .reviewer-info h4 {
        color: var(--text-color);
        margin-bottom: 0.25rem;
    }

    .review-stars {
        color: #FFD700;
        font-size: 0.9rem;
    }

    .review-text {
        color: var(--text-color);
        line-height: 1.6;
        opacity: 0.9;
        font-style: italic;
    }
    
    @media (max-width: 968px) {
        .google-maps-container {
            grid-template-columns: 1fr;
        }
        
        .map-wrapper {
            height: 350px;
        }
    }
    
    @media (max-width: 768px) {
        .hero-logo {
            width: 120px;
            height: 120px;
        }
        
        .hero h1 {
            font-size: 2rem;
        }
        
        .hero p {
            font-size: 1.1rem;
        }
        
        .cta-section h2 {
            font-size: 1.8rem;
        }
        
        .review-highlights {
            grid-template-columns: 1fr;
        }
        
        .sample-reviews {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="hero card">
    <div class="hero-content">
        <img src="{% static 'images/logo.jpg' %}" alt="Logo" class="hero-logo" onerror="this.style.display='none'">
        <h1>Ch√†o M·ª´ng ƒê·∫øn V·ªõi B√≤ Nh√∫ng Gi·∫•m Ng√†y X∆∞a!</h1>
        <p>Tr·∫£i nghi·ªám h∆∞∆°ng v·ªã truy·ªÅn th·ªëng Vi·ªát Nam v·ªõi nguy√™n li·ªáu t∆∞∆°i ngon v√† ƒëam m√™ ·∫©m th·ª±c</p>
        <div class="hero-buttons">
            {% if user.is_authenticated %}
                <a href="{% url 'menu' %}" class="btn">Xem Th·ª±c ƒê∆°n</a>
                <a href="{% url 'place_order' %}" class="btn btn-secondary">ƒê·∫∑t M√≥n Ngay</a>
            {% else %}
                <a href="{% url 'signup' %}" class="btn">ƒêƒÉng K√Ω Ngay</a>
                <a href="{% url 'menu' %}" class="btn btn-secondary">Xem Th·ª±c ƒê∆°n</a>
            {% endif %}
        </div>
    </div>
</div>

{% if latest_news %}
<section>
    <h2 class="section-title">üì∞ Tin T·ª©c & Khuy·∫øn M√£i M·ªõi Nh·∫•t</h2>
    <div class="grid">
        {% for news in latest_news %}
        <a href="{% url 'feed_detail' news.id %}" class="news-card">
            <div class="news-card-media">
                {% if news.video %}
                    <!-- Video Preview with Autoplay -->
                    <video 
                        autoplay 
                        loop 
                        muted 
                        playsinline 
                        preload="auto"
                        class="news-video"
                        style="pointer-events: none;">
                        <source src="{{ news.video.url }}" type="video/mp4">
                    </video>
                    <div class="video-badge">
                        üé¨ Video
                    </div>
                    <div class="news-overlay">
                        <i class="fas fa-play-circle"></i>
                        Xem Video
                    </div>
                {% elif news.image %}
                    <!-- Image -->
                    <img src="{{ news.image.url }}" alt="{{ news.title }}">
                    <div class="news-overlay">
                        <i class="fas fa-arrow-right"></i>
                        ƒê·ªçc Th√™m
                    </div>
                {% else %}
                    <!-- No Media -->
                    <div class="no-media-icon">üì∞</div>
                    <div class="news-overlay">
                        <i class="fas fa-arrow-right"></i>
                        ƒê·ªçc Th√™m
                    </div>
                {% endif %}
            </div>
            <div class="news-card-content">
                <h3>{{ news.title }}</h3>
                <p>{{ news.content|truncatewords:30 }}</p>
                <small>
                    <i class="fas fa-calendar"></i>
                    {{ news.created_at|date:"d/m/Y" }}
                </small>
            </div>
        </a>
        {% endfor %}
    </div>
    <div style="text-align: center;">
        <a href="{% url 'feeds' %}" class="btn">Xem T·∫•t C·∫£ Tin T·ª©c</a>
    </div>
</section>
{% endif %}

{% if featured_items %}
<section>
    <h2 class="section-title">‚≠ê M√≥n ƒÇn N·ªïi B·∫≠t</h2>
    <div class="grid">
        {% for item in featured_items %}
        <div class="item-card">
            <h3>{{ item.name }}</h3>
            <p>{{ item.description|truncatewords:15 }}</p>
            <div class="price">{{ item.price|vnd_format }} <span class="currency">‚Ç´</span></div>
        </div>
        {% endfor %}
    </div>
    <div style="text-align: center;">
        <a href="{% url 'menu' %}" class="btn">Xem To√†n B·ªô Th·ª±c ƒê∆°n</a>
    </div>
</section>
{% endif %}

<!-- Google Reviews Section -->
<section class="reviews-section">
    <div class="container">
        <h2 class="section-title">‚≠ê ƒê√°nh Gi√° T·ª´ Kh√°ch H√†ng</h2>
        <p style="text-align: center; color: var(--text-color); opacity: 0.8; font-size: 1.1rem; margin-bottom: 3rem;">
            Xem c√°c ƒë√°nh gi√° t·ª´ kh√°ch h√†ng th·ª±c t·∫ø tr√™n Google Maps
        </p>

        <div class="google-maps-container">
            <!-- Google Maps Embed -->
            <div class="map-wrapper">
                <iframe 
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d245.54092675725733!2d105.77067548793478!3d10.038286149532776!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31a0883d181a2ee1%3A0x5d8f6ec3df7f6c9!2zQsOyIE5ow7puZyBHaeG6pW0gTmfDoHkgWMaw!5e0!3m2!1svi!2svn!4v1234567890!5m2!1svi!2svn"
                    width="100%" 
                    height="450" 
                    style="border:0; border-radius: 10px;" 
                    allowfullscreen="" 
                    loading="lazy" 
                    referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>

            <!-- Review Summary Card -->
            <div class="review-summary">
                <div class="rating-overview">
                    <div class="rating-score">
                        <span class="score">4.8</span>
                        <div class="stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <p class="review-count">Nhi·ªÅu ƒë√°nh gi√° tr√™n Google</p>
                    </div>
                </div>

                <div class="review-highlights">
                    <div class="highlight-item">
                        <i class="fas fa-utensils"></i>
                        <span>Th·ª±c ƒë∆°n ƒëa d·∫°ng</span>
                    </div>
                    <div class="highlight-item">
                        <i class="fas fa-thumbs-up"></i>
                        <span>Ch·∫•t l∆∞·ª£ng tuy·ªát v·ªùi</span>
                    </div>
                    <div class="highlight-item">
                        <i class="fas fa-smile"></i>
                        <span>Ph·ª•c v·ª• t·∫≠n t√¨nh</span>
                    </div>
                    <div class="highlight-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>V·ªã tr√≠ thu·∫≠n ti·ªán</span>
                    </div>
                </div>

                <a href="https://www.google.com/maps/place/B%C3%B2+Nh%C3%BAng+Gi%E1%BA%A5m+-+Ng%C3%A0y+X%C6%B0a/@10.0220114,105.7425938,17z/data=!4m18!1m9!3m8!1s0x31a0890057173d5d:0xacf5028e89f13e4!2zQsOyIE5ow7puZyBHaeG6pW0gLSBOZ8OgeSBYxrBh!8m2!3d10.0220061!4d105.7451687!9m1!1b1!16s%2Fg%2F11m5xwxfnb!3m7!1s0x31a0890057173d5d:0xacf5028e89f13e4!8m2!3d10.0220061!4d105.7451687!9m1!1b1!16s%2Fg%2F11m5xwxfnb?entry=ttu&g_ep=EgoyMDI1MTIwMi4wIKXMDSoASAFQAw%3D%3D" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="view-reviews-btn">
                    <i class="fab fa-google"></i>
                    Xem T·∫•t C·∫£ ƒê√°nh Gi√°
                </a>

                <a href="https://www.google.com/maps/place/B%C3%B2+Nh%C3%BAng+Gi%E1%BA%A5m+-+Ng%C3%A0y+X%C6%B0a/@10.0220114,105.7425938,17z/data=!4m18!1m9!3m8!1s0x31a0890057173d5d:0xacf5028e89f13e4!2zQsOyIE5ow7puZyBHaeG6pW0gLSBOZ8OgeSBYxrBh!8m2!3d10.0220061!4d105.7451687!9m1!1b1!16s%2Fg%2F11m5xwxfnb!3m7!1s0x31a0890057173d5d:0xacf5028e89f13e4!8m2!3d10.0220061!4d105.7451687!9m1!1b1!16s%2Fg%2F11m5xwxfnb?entry=ttu&g_ep=EgoyMDI1MTIwMi4wIKXMDSoASAFQAw%3D%3D" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="write-review-btn">
                    <i class="fas fa-edit"></i>
                    Vi·∫øt ƒê√°nh Gi√°
                </a>
            </div>
        </div>

        <!-- Sample Reviews -->
        <div class="sample-reviews">
            <div class="review-card">
                <div class="review-header">
                    <div class="reviewer-info">
                        <div class="reviewer-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h4>Kh√°ch H√†ng</h4>
                            <div class="review-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <p class="review-text">"M√≥n ƒÉn r·∫•t ngon, ph·ª•c v·ª• t·∫≠n t√¨nh. ƒê·∫∑c bi·ªát b√≤ nh√∫ng gi·∫•m r·∫•t ƒë·∫≠m ƒë√†. S·∫Ω quay l·∫°i!"</p>
            </div>

            <div class="review-card">
                <div class="review-header">
                    <div class="reviewer-info">
                        <div class="reviewer-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h4>Kh√°ch H√†ng</h4>
                            <div class="review-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <p class="review-text">"Kh√¥ng gian ·∫•m c√∫ng, m√≥n ƒÉn t∆∞∆°i ngon. Gi√° c·∫£ h·ª£p l√Ω. R·∫•t h√†i l√≤ng!"</p>
            </div>

            <div class="review-card">
                <div class="review-header">
                    <div class="reviewer-info">
                        <div class="reviewer-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h4>Kh√°ch H√†ng</h4>
                            <div class="review-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <p class="review-text">"Qu√°n ƒÉn truy·ªÅn th·ªëng tuy·ªát v·ªùi! B√≤ nh√∫ng gi·∫•m ƒë√∫ng v·ªã, gia v·ªã ƒë·∫≠m ƒë√†."</p>
            </div>
        </div>
    </div>
</section>

<div class="cta-section">
    <h2>Nh·∫≠n ƒêi·ªÉm Th∆∞·ªüng V·ªõi M·ªói ƒê∆°n H√†ng! üéÅ</h2>
    <p style="font-size: 1.2rem; margin-bottom: 2rem;">
        Nh·∫≠n l·∫°i 10% ƒëi·ªÉm cho m·ªói l·∫ßn mua h√†ng. ƒê·ªïi ƒëi·ªÉm l·∫•y m√≥n ƒÉn mi·ªÖn ph√≠ v√† tr·ªü th√†nh VIP!
    </p>
    {% if not user.is_authenticated %}
    <a href="{% url 'signup' %}" class="btn" style="background: white; color: #D4A843; font-weight: bold;">ƒêƒÉng K√Ω Ngay</a>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Force autoplay videos on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Find all video elements
        const videos = document.querySelectorAll('.news-video');
        
        videos.forEach(video => {
            // Ensure video is muted (required for autoplay)
            video.muted = true;
            video.volume = 0;
            
            // Try to play
            const playPromise = video.play();
            
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log('Video autoplay started successfully');
                    })
                    .catch(error => {
                        console.log('Autoplay prevented:', error);
                        // If autoplay fails, try again on user interaction
                        document.addEventListener('click', function playOnClick() {
                            video.play();
                            document.removeEventListener('click', playOnClick);
                        }, { once: true });
                    });
            }
            
            // Pause on hover to show overlay
            const card = video.closest('.news-card');
            if (card) {
                card.addEventListener('mouseenter', () => {
                    video.pause();
                });
                card.addEventListener('mouseleave', () => {
                    video.play();
                });
            }
        });
    });
</script>
{% endblock %}